from tokenizers import Tokenizer, normalizers, pre_tokenizers
from tokenizers import Regex, decoders
from tokenizers.models import BPE
from tokenizers.trainers import BpeTrainer
import emoji

tokenizer = Tokenizer(BPE(unk_token='<unk>', fuse_unk=True, byte_fallback=True))

tokenizer.normalizer = normalizers.Sequence([
    normalizers.NFKC(),
    normalizers.Replace('\u0000', ' '),
    normalizers.Replace('\u000b', ' '),
    normalizers.Replace(Regex(r'\s+'), 'Ä '),
    normalizers.Replace(Regex(r'(.)\1{3,}'), 'â€¦')
])

regex_unicode = r'''([\x00-\x40\x5B-\x60\x7B-\x7F]|[^\x00-\xffÄ ]|[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5])+'''
regex_number = r'''\d|[é›¶ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åç™¾åƒä¸‡äº¿]|\.|\+|\-'''
tokenizer.pre_tokenizer = pre_tokenizers.Sequence([
    pre_tokenizers.Split('Ä ', behavior='merged_with_next'),
    pre_tokenizers.Split('Â§', behavior='isolated'),
    pre_tokenizers.Split(Regex(regex_number), behavior='isolated'),
    pre_tokenizers.Split(Regex(regex_unicode), behavior='isolated'),
    pre_tokenizers.Split(Regex('Ä *(\w+|[^\w\sÄ ]+)'), behavior='isolated')
])
tokenizer.decoder = decoders.Sequence([
    decoders.Replace('Ä ', ' '),
    decoders.ByteFallback()
])

alphabet = [f'<0x{hex(i)[2:].upper():>02}>' for i in range(256)]
com_emoji = ['áƒš', 'áƒ¦', 'â€¼', 'â‰', 'â‚½', 'âƒ£', 'â„¢', 'â„¹', 'â†', 'â†‘', 'â†’', 'â†“', 'â†”', 'â†•', 'â†–', 'â†—', 'â†˜', 'â†™', 'â†©', 'â†ª', 'âˆ',
             'âŒš', 'âŒ›', 'âŒ¨', 'â', 'â©', 'âª', 'â«', 'â¬', 'â­', 'â®', 'â¯', 'â°', 'â±', 'â²', 'â³', 'â¸', 'â¹', 'âº', 'â–ª', 'â–«', 'â–²',
             'â–¶', 'â–¼', 'â—€', 'â—‹', 'â—', 'â—»', 'â—¼', 'â—½', 'â—¾', 'â˜€', 'â˜', 'â˜‚', 'â˜ƒ', 'â˜„', 'â˜…', 'â˜', 'â˜‘', 'â˜”', 'â˜•', 'â˜˜', 'â˜š',
             'â˜›', 'â˜œ', 'â˜', 'â˜', 'â˜Ÿ', 'â˜ ', 'â˜¢', 'â˜£', 'â˜¦', 'â˜ª', 'â˜«', 'â˜¬', 'â˜®', 'â˜¯', 'â˜°', 'â˜±', 'â˜²', 'â˜³', 'â˜´', 'â˜µ', 'â˜¶',
             'â˜·', 'â˜¸', 'â˜¹', 'â˜º', 'â˜»', 'â˜¼', 'â˜½', 'â˜¾', 'â˜¿', 'â™€', 'â™‚', 'â™…', 'â™†', 'â™‡', 'â™ˆ', 'â™‰', 'â™Š', 'â™‹', 'â™Œ', 'â™', 'â™',
             'â™', 'â™', 'â™‘', 'â™’', 'â™“', 'â™”', 'â™•', 'â™–', 'â™—', 'â™Ÿ', 'â™ ', 'â™¡', 'â™£', 'â™¥', 'â™¦', 'â™§', 'â™¨', 'â™©', 'â™ª', 'â™«', 'â™¬',
             'â™»', 'â™¾', 'â™¿', 'âš', 'âš‘', 'âš’', 'âš“', 'âš”', 'âš•', 'âš–', 'âš—', 'âš˜', 'âš™', 'âš›', 'âšœ', 'âš ', 'âš¡', 'âš¢', 'âš£', 'âš¤', 'âš¥',
             'âš¦', 'âš§', 'âšª', 'âš«', 'âš°', 'âš±', 'âš½', 'âš¾', 'âš¿', 'â›„', 'â›…', 'â›‡', 'â›ˆ', 'â›', 'â›', 'â›‘', 'â›“', 'â›”', 'â›Ÿ', 'â›©', 'â›ª',
             'â›°', 'â›±', 'â›²', 'â›³', 'â›´', 'â›µ', 'â›¶', 'â›·', 'â›¸', 'â›¹', 'â›½', 'âœ‚', 'âœ…', 'âœ‰', 'âœŠ', 'âœ‹', 'âœŒ', 'âœ', 'âœ', 'âœ’', 'âœ”',
             'âœ–', 'âœ', 'âœ¡', 'âœ¨', 'âœ³', 'âœ´', 'â„', 'â‡', 'âŒ', 'â', 'â“', 'â—', 'â£', 'â¤', 'â¥', 'â¦', 'â§', 'â•', 'â–', 'â—', 'â¡',
             'â°', 'â¿', 'â¬…', 'â¬†', 'â¬‡', 'â¬›', 'â¬œ', 'â­', 'â­•', 'ã€Œ', 'ã€', 'ã€', 'ã€', 'ã€°', 'ã€½', 'ãŠ—', 'ãŠ™', 'ï¸', 'ğŸ€€', 'ğŸ€', 'ğŸ€‚',
             'ğŸ€ƒ', 'ğŸ€„', 'ğŸ€…', 'ğŸ€†', 'ğŸ€‡', 'ğŸ€ˆ', 'ğŸ€‰', 'ğŸ€Š', 'ğŸ€‹', 'ğŸ€Œ', 'ğŸ€', 'ğŸ€', 'ğŸ€', 'ğŸ€', 'ğŸ€‘', 'ğŸ€’', 'ğŸ€“', 'ğŸ€”', 'ğŸ€•', 'ğŸ€–', 'ğŸ€—',
             'ğŸ€˜', 'ğŸ€™', 'ğŸ€š', 'ğŸ€›', 'ğŸ€œ', 'ğŸ€', 'ğŸ€', 'ğŸ€Ÿ', 'ğŸ€ ', 'ğŸ€¡', 'ğŸ€¢', 'ğŸ€£', 'ğŸ€¥', 'ğŸ€¦', 'ğŸ€¨', 'ğŸ€©', 'ğŸ€ª', 'ğŸƒ', 'ğŸ…°', 'ğŸ…±', 'ğŸ…¾',
             'ğŸ…¿', 'ğŸ†', 'ğŸ†‘', 'ğŸ†’', 'ğŸ†“', 'ğŸ†”', 'ğŸ†•', 'ğŸ†–', 'ğŸ†—', 'ğŸ†˜', 'ğŸ†™', 'ğŸ†š', 'ğŸ‡¦', 'ğŸ‡§', 'ğŸ‡¨', 'ğŸ‡©', 'ğŸ‡ª', 'ğŸ‡«', 'ğŸ‡¬', 'ğŸ‡­', 'ğŸ‡®',
             'ğŸ‡¯', 'ğŸ‡°', 'ğŸ‡±', 'ğŸ‡²', 'ğŸ‡³', 'ğŸ‡´', 'ğŸ‡µ', 'ğŸ‡¶', 'ğŸ‡·', 'ğŸ‡¸', 'ğŸ‡¹', 'ğŸ‡º', 'ğŸ‡»', 'ğŸ‡¼', 'ğŸ‡½', 'ğŸ‡¾', 'ğŸ‡¿', 'ğŸˆ', 'ğŸˆ‚', 'ğŸˆš', 'ğŸˆ¯',
             'ğŸˆ²', 'ğŸˆ³', 'ğŸˆ´', 'ğŸˆµ', 'ğŸˆ¶', 'ğŸˆ·', 'ğŸˆ¸', 'ğŸˆ¹', 'ğŸˆº', 'ğŸ‰', 'ğŸ‰‘', 'ğŸŒ€', 'ğŸŒ', 'ğŸŒ‚', 'ğŸŒƒ', 'ğŸŒ„', 'ğŸŒ…', 'ğŸŒ†', 'ğŸŒ‡', 'ğŸŒˆ', 'ğŸŒ‰',
             'ğŸŒŠ', 'ğŸŒ‹', 'ğŸŒŒ', 'ğŸŒ', 'ğŸŒ', 'ğŸŒ', 'ğŸŒ', 'ğŸŒ‘', 'ğŸŒ’', 'ğŸŒ“', 'ğŸŒ”', 'ğŸŒ•', 'ğŸŒ–', 'ğŸŒ—', 'ğŸŒ˜', 'ğŸŒ™', 'ğŸŒš', 'ğŸŒ›', 'ğŸŒœ', 'ğŸŒ', 'ğŸŒ',
             'ğŸŒŸ', 'ğŸŒ ', 'ğŸŒ¡', 'ğŸŒ¢', 'ğŸŒ£', 'ğŸŒ¤', 'ğŸŒ¥', 'ğŸŒ¦', 'ğŸŒ§', 'ğŸŒ¨', 'ğŸŒ©', 'ğŸŒª', 'ğŸŒ«', 'ğŸŒ¬', 'ğŸŒ­', 'ğŸŒ®', 'ğŸŒ¯', 'ğŸŒ°', 'ğŸŒ±', 'ğŸŒ²', 'ğŸŒ³',
             'ğŸŒ´', 'ğŸŒµ', 'ğŸŒ¶', 'ğŸŒ·', 'ğŸŒ¸', 'ğŸŒ¹', 'ğŸŒº', 'ğŸŒ»', 'ğŸŒ¼', 'ğŸŒ½', 'ğŸŒ¾', 'ğŸŒ¿', 'ğŸ€', 'ğŸ', 'ğŸ‚', 'ğŸƒ', 'ğŸ„', 'ğŸ…', 'ğŸ†', 'ğŸ‡', 'ğŸˆ',
             'ğŸ‰', 'ğŸŠ', 'ğŸ‹', 'ğŸŒ', 'ğŸ', 'ğŸ', 'ğŸ', 'ğŸ', 'ğŸ‘', 'ğŸ’', 'ğŸ“', 'ğŸ”', 'ğŸ•', 'ğŸ–', 'ğŸ—', 'ğŸ˜', 'ğŸ™', 'ğŸš', 'ğŸ›', 'ğŸœ', 'ğŸ',
             'ğŸ', 'ğŸŸ', 'ğŸ ', 'ğŸ¡', 'ğŸ¢', 'ğŸ£', 'ğŸ¤', 'ğŸ¥', 'ğŸ¦', 'ğŸ§', 'ğŸ¨', 'ğŸ©', 'ğŸª', 'ğŸ«', 'ğŸ¬', 'ğŸ­', 'ğŸ®', 'ğŸ¯', 'ğŸ°', 'ğŸ±', 'ğŸ²',
             'ğŸ³', 'ğŸ´', 'ğŸµ', 'ğŸ¶', 'ğŸ·', 'ğŸ¸', 'ğŸ¹', 'ğŸº', 'ğŸ»', 'ğŸ¼', 'ğŸ½', 'ğŸ¾', 'ğŸ¿', 'ğŸ€', 'ğŸ', 'ğŸ‚', 'ğŸƒ', 'ğŸ„', 'ğŸ…', 'ğŸ†', 'ğŸ‡',
             'ğŸˆ', 'ğŸ‰', 'ğŸŠ', 'ğŸ‹', 'ğŸŒ', 'ğŸ', 'ğŸ', 'ğŸ', 'ğŸ', 'ğŸ‘', 'ğŸ’', 'ğŸ“', 'ğŸ•', 'ğŸ–', 'ğŸ—', 'ğŸ™', 'ğŸš', 'ğŸ›', 'ğŸ', 'ğŸŸ', 'ğŸ ',
             'ğŸ¡', 'ğŸ¢', 'ğŸ£', 'ğŸ¤', 'ğŸ¥', 'ğŸ¦', 'ğŸ§', 'ğŸ¨', 'ğŸ©', 'ğŸª', 'ğŸ«', 'ğŸ¬', 'ğŸ­', 'ğŸ®', 'ğŸ¯', 'ğŸ°', 'ğŸ±', 'ğŸ²', 'ğŸ³', 'ğŸ´', 'ğŸµ',
             'ğŸ¶', 'ğŸ·', 'ğŸ¸', 'ğŸ¹', 'ğŸº', 'ğŸ»', 'ğŸ¼', 'ğŸ½', 'ğŸ¾', 'ğŸ¿', 'ğŸ€', 'ğŸ', 'ğŸ‚', 'ğŸƒ', 'ğŸ„', 'ğŸ…', 'ğŸ†', 'ğŸ‡', 'ğŸˆ', 'ğŸ‰', 'ğŸŠ',
             'ğŸ‹', 'ğŸŒ', 'ğŸ', 'ğŸ', 'ğŸ', 'ğŸ', 'ğŸ‘', 'ğŸ’', 'ğŸ“', 'ğŸ”', 'ğŸ•', 'ğŸ–', 'ğŸ—', 'ğŸ˜', 'ğŸ™', 'ğŸš', 'ğŸ›', 'ğŸœ', 'ğŸ', 'ğŸ', 'ğŸŸ',
             'ğŸ ', 'ğŸ¡', 'ğŸ¢', 'ğŸ£', 'ğŸ¤', 'ğŸ¥', 'ğŸ¦', 'ğŸ§', 'ğŸ¨', 'ğŸ©', 'ğŸª', 'ğŸ«', 'ğŸ¬', 'ğŸ­', 'ğŸ®', 'ğŸ¯', 'ğŸ°', 'ğŸ³', 'ğŸ´', 'ğŸµ', 'ğŸ¸',
             'ğŸ¹', 'ğŸº', 'ğŸ»', 'ğŸ€', 'ğŸ', 'ğŸ‚', 'ğŸƒ', 'ğŸ„', 'ğŸ…', 'ğŸ†', 'ğŸ‡', 'ğŸˆ', 'ğŸ‰', 'ğŸŠ', 'ğŸ‹', 'ğŸŒ', 'ğŸ', 'ğŸ', 'ğŸ', 'ğŸ', 'ğŸ‘',
             'ğŸ’', 'ğŸ“', 'ğŸ”', 'ğŸ•', 'ğŸ–', 'ğŸ—', 'ğŸ˜', 'ğŸ™', 'ğŸš', 'ğŸ›', 'ğŸœ', 'ğŸ', 'ğŸ', 'ğŸŸ', 'ğŸ ', 'ğŸ¡', 'ğŸ¢', 'ğŸ£', 'ğŸ¤', 'ğŸ¥', 'ğŸ¦',
             'ğŸ§', 'ğŸ¨', 'ğŸ©', 'ğŸª', 'ğŸ«', 'ğŸ¬', 'ğŸ­', 'ğŸ®', 'ğŸ¯', 'ğŸ°', 'ğŸ±', 'ğŸ²', 'ğŸ³', 'ğŸ´', 'ğŸµ', 'ğŸ¶', 'ğŸ·', 'ğŸ¸', 'ğŸ¹', 'ğŸº', 'ğŸ»',
             'ğŸ¼', 'ğŸ½', 'ğŸ¾', 'ğŸ¿', 'ğŸ‘€', 'ğŸ‘', 'ğŸ‘‚', 'ğŸ‘ƒ', 'ğŸ‘„', 'ğŸ‘…', 'ğŸ‘†', 'ğŸ‘‡', 'ğŸ‘ˆ', 'ğŸ‘‰', 'ğŸ‘Š', 'ğŸ‘‹', 'ğŸ‘Œ', 'ğŸ‘', 'ğŸ‘', 'ğŸ‘', 'ğŸ‘',
             'ğŸ‘‘', 'ğŸ‘’', 'ğŸ‘“', 'ğŸ‘”', 'ğŸ‘•', 'ğŸ‘–', 'ğŸ‘—', 'ğŸ‘˜', 'ğŸ‘™', 'ğŸ‘š', 'ğŸ‘›', 'ğŸ‘œ', 'ğŸ‘', 'ğŸ‘', 'ğŸ‘Ÿ', 'ğŸ‘ ', 'ğŸ‘¡', 'ğŸ‘¢', 'ğŸ‘£', 'ğŸ‘¤', 'ğŸ‘¥',
             'ğŸ‘¦', 'ğŸ‘§', 'ğŸ‘¨', 'ğŸ‘©', 'ğŸ‘ª', 'ğŸ‘«', 'ğŸ‘¬', 'ğŸ‘­', 'ğŸ‘®', 'ğŸ‘°', 'ğŸ‘±', 'ğŸ‘²', 'ğŸ‘³', 'ğŸ‘´', 'ğŸ‘µ', 'ğŸ‘¶', 'ğŸ‘·', 'ğŸ‘¸', 'ğŸ‘¹', 'ğŸ‘º', 'ğŸ‘»',
             'ğŸ‘¼', 'ğŸ‘½', 'ğŸ‘¾', 'ğŸ‘¿', 'ğŸ’€', 'ğŸ’', 'ğŸ’‚', 'ğŸ’„', 'ğŸ’…', 'ğŸ’†', 'ğŸ’‡', 'ğŸ’ˆ', 'ğŸ’‰', 'ğŸ’Š', 'ğŸ’‹', 'ğŸ’Œ', 'ğŸ’', 'ğŸ’', 'ğŸ’', 'ğŸ’', 'ğŸ’‘',
             'ğŸ’’', 'ğŸ’“', 'ğŸ’”', 'ğŸ’•', 'ğŸ’–', 'ğŸ’—', 'ğŸ’˜', 'ğŸ’™', 'ğŸ’š', 'ğŸ’›', 'ğŸ’œ', 'ğŸ’', 'ğŸ’', 'ğŸ’Ÿ', 'ğŸ’ ', 'ğŸ’¡', 'ğŸ’¢', 'ğŸ’£', 'ğŸ’¤', 'ğŸ’¥', 'ğŸ’¦',
             'ğŸ’§', 'ğŸ’¨', 'ğŸ’©', 'ğŸ’ª', 'ğŸ’«', 'ğŸ’¬', 'ğŸ’­', 'ğŸ’®', 'ğŸ’¯', 'ğŸ’°', 'ğŸ’±', 'ğŸ’²', 'ğŸ’³', 'ğŸ’´', 'ğŸ’µ', 'ğŸ’¶', 'ğŸ’¸', 'ğŸ’¹', 'ğŸ’º', 'ğŸ’»', 'ğŸ’¼',
             'ğŸ’½', 'ğŸ’¾', 'ğŸ’¿', 'ğŸ“€', 'ğŸ“', 'ğŸ“‚', 'ğŸ“„', 'ğŸ“…', 'ğŸ“†', 'ğŸ“‡', 'ğŸ“ˆ', 'ğŸ“‰', 'ğŸ“Š', 'ğŸ“‹', 'ğŸ“Œ', 'ğŸ“', 'ğŸ“', 'ğŸ“', 'ğŸ“', 'ğŸ“‘', 'ğŸ“’',
             'ğŸ““', 'ğŸ“”', 'ğŸ“•', 'ğŸ“–', 'ğŸ“—', 'ğŸ“˜', 'ğŸ“™', 'ğŸ“š', 'ğŸ“›', 'ğŸ“œ', 'ğŸ“', 'ğŸ“', 'ğŸ“Ÿ', 'ğŸ“ ', 'ğŸ“¡', 'ğŸ“¢', 'ğŸ“£', 'ğŸ“¤', 'ğŸ“¥', 'ğŸ“¦', 'ğŸ“§',
             'ğŸ“¨', 'ğŸ“©', 'ğŸ“®', 'ğŸ“¯', 'ğŸ“°', 'ğŸ“±', 'ğŸ“²', 'ğŸ“³', 'ğŸ“´', 'ğŸ“µ', 'ğŸ“¶', 'ğŸ“·', 'ğŸ“¹', 'ğŸ“º', 'ğŸ“»', 'ğŸ“¼', 'ğŸ“¿', 'ğŸ”€', 'ğŸ”', 'ğŸ”‚', 'ğŸ”ƒ',
             'ğŸ”„', 'ğŸ”…', 'ğŸ”†', 'ğŸ”‡', 'ğŸ”ˆ', 'ğŸ”‰', 'ğŸ”Š', 'ğŸ”‹', 'ğŸ”Œ', 'ğŸ”', 'ğŸ”', 'ğŸ”', 'ğŸ”', 'ğŸ”‘', 'ğŸ”’', 'ğŸ”“', 'ğŸ””', 'ğŸ”•', 'ğŸ”–', 'ğŸ”—', 'ğŸ”˜',
             'ğŸ”™', 'ğŸ”š', 'ğŸ”›', 'ğŸ”œ', 'ğŸ”', 'ğŸ”', 'ğŸ”Ÿ', 'ğŸ” ', 'ğŸ”¡', 'ğŸ”¢', 'ğŸ”£', 'ğŸ”¤', 'ğŸ”¥', 'ğŸ”¦', 'ğŸ”§', 'ğŸ”¨', 'ğŸ”©', 'ğŸ”ª', 'ğŸ”«', 'ğŸ”¬', 'ğŸ”­',
             'ğŸ”®', 'ğŸ”¯', 'ğŸ”°', 'ğŸ”±', 'ğŸ”²', 'ğŸ”³', 'ğŸ”´', 'ğŸ”µ', 'ğŸ”¶', 'ğŸ”·', 'ğŸ”¸', 'ğŸ”¹', 'ğŸ”º', 'ğŸ”»', 'ğŸ”¼', 'ğŸ”½', 'ğŸ•†', 'ğŸ•‰', 'ğŸ•Š', 'ğŸ•‹', 'ğŸ•Œ',
             'ğŸ•', 'ğŸ•', 'ğŸ•', 'ğŸ•‘', 'ğŸ•’', 'ğŸ•“', 'ğŸ•”', 'ğŸ••', 'ğŸ•–', 'ğŸ•—', 'ğŸ•˜', 'ğŸ•™', 'ğŸ•š', 'ğŸ•›', 'ğŸ•œ', 'ğŸ•', 'ğŸ•', 'ğŸ•Ÿ', 'ğŸ• ', 'ğŸ•¡', 'ğŸ•¢',
             'ğŸ•£', 'ğŸ•¤', 'ğŸ•¥', 'ğŸ•¦', 'ğŸ•§', 'ğŸ•­', 'ğŸ•¯', 'ğŸ•°', 'ğŸ•±', 'ğŸ•³', 'ğŸ•¶', 'ğŸ•·', 'ğŸ•¸', 'ğŸ•¹', 'ğŸ•¿', 'ğŸ–‚', 'ğŸ–Š', 'ğŸ–‹', 'ğŸ–Œ', 'ğŸ–', 'ğŸ–',
             'ğŸ–’', 'ğŸ–•', 'ğŸ––', 'ğŸ–¤', 'ğŸ–¥', 'ğŸ–¨', 'ğŸ–±', 'ğŸ–²', 'ğŸ–¼', 'ğŸ—ƒ', 'ğŸ—„', 'ğŸ—‘', 'ğŸ—’', 'ğŸ—“', 'ğŸ—”', 'ğŸ—œ', 'ğŸ—', 'ğŸ—', 'ğŸ—¡', 'ğŸ—£', 'ğŸ—¦',
             'ğŸ—§', 'ğŸ—¨', 'ğŸ—ª', 'ğŸ—¯', 'ğŸ—²', 'ğŸ—³', 'ğŸ—´', 'ğŸ—¶', 'ğŸ—¸', 'ğŸ—¹', 'ğŸ—º', 'ğŸ—»', 'ğŸ—¼', 'ğŸ—½', 'ğŸ—¾', 'ğŸ—¿', 'ğŸ˜€', 'ğŸ˜', 'ğŸ˜‚', 'ğŸ˜ƒ', 'ğŸ˜„',
             'ğŸ˜…', 'ğŸ˜†', 'ğŸ˜‡', 'ğŸ˜ˆ', 'ğŸ˜‰', 'ğŸ˜Š', 'ğŸ˜‹', 'ğŸ˜Œ', 'ğŸ˜', 'ğŸ˜', 'ğŸ˜', 'ğŸ˜', 'ğŸ˜‘', 'ğŸ˜’', 'ğŸ˜“', 'ğŸ˜”', 'ğŸ˜•', 'ğŸ˜–', 'ğŸ˜—', 'ğŸ˜˜', 'ğŸ˜™',
             'ğŸ˜š', 'ğŸ˜›', 'ğŸ˜œ', 'ğŸ˜', 'ğŸ˜', 'ğŸ˜Ÿ', 'ğŸ˜ ', 'ğŸ˜¡', 'ğŸ˜¢', 'ğŸ˜£', 'ğŸ˜¤', 'ğŸ˜¥', 'ğŸ˜¦', 'ğŸ˜§', 'ğŸ˜¨', 'ğŸ˜©', 'ğŸ˜ª', 'ğŸ˜«', 'ğŸ˜¬', 'ğŸ˜­', 'ğŸ˜®',
             'ğŸ˜¯', 'ğŸ˜°', 'ğŸ˜±', 'ğŸ˜²', 'ğŸ˜³', 'ğŸ˜´', 'ğŸ˜µ', 'ğŸ˜¶', 'ğŸ˜·', 'ğŸ˜¸', 'ğŸ˜¹', 'ğŸ˜º', 'ğŸ˜»', 'ğŸ˜¼', 'ğŸ˜½', 'ğŸ˜¾', 'ğŸ˜¿', 'ğŸ™€', 'ğŸ™', 'ğŸ™‚', 'ğŸ™ƒ',
             'ğŸ™„', 'ğŸ™…', 'ğŸ™†', 'ğŸ™‡', 'ğŸ™ˆ', 'ğŸ™‰', 'ğŸ™Š', 'ğŸ™‹', 'ğŸ™Œ', 'ğŸ™', 'ğŸ™', 'ğŸ™', 'ğŸš€', 'ğŸš', 'ğŸš‚', 'ğŸšƒ', 'ğŸš„', 'ğŸš…', 'ğŸš†', 'ğŸš‡', 'ğŸšˆ',
             'ğŸš‰', 'ğŸšŠ', 'ğŸš‹', 'ğŸšŒ', 'ğŸš', 'ğŸš', 'ğŸš', 'ğŸš', 'ğŸš‘', 'ğŸš’', 'ğŸš“', 'ğŸš”', 'ğŸš•', 'ğŸš–', 'ğŸš—', 'ğŸš˜', 'ğŸš™', 'ğŸšš', 'ğŸš›', 'ğŸšœ', 'ğŸš',
             'ğŸš', 'ğŸšŸ', 'ğŸš ', 'ğŸš¡', 'ğŸš¢', 'ğŸš£', 'ğŸš¤', 'ğŸš¥', 'ğŸš¦', 'ğŸš§', 'ğŸš¨', 'ğŸš©', 'ğŸšª', 'ğŸš«', 'ğŸš¬', 'ğŸš­', 'ğŸš®', 'ğŸš¯', 'ğŸš°', 'ğŸš±', 'ğŸš²',
             'ğŸš³', 'ğŸš´', 'ğŸšµ', 'ğŸš¶', 'ğŸš¸', 'ğŸš¹', 'ğŸšº', 'ğŸš»', 'ğŸš¼', 'ğŸš½', 'ğŸš¾', 'ğŸš¿', 'ğŸ›€', 'ğŸ›', 'ğŸ›‚', 'ğŸ›ƒ', 'ğŸ›„', 'ğŸ›…', 'ğŸ›†', 'ğŸ›ˆ', 'ğŸ›‰',
             'ğŸ›Š', 'ğŸ›‹', 'ğŸ›Œ', 'ğŸ›', 'ğŸ›', 'ğŸ›', 'ğŸ›', 'ğŸ›‘', 'ğŸ›’', 'ğŸ›•', 'ğŸ›¡', 'ğŸ›¢', 'ğŸ›£', 'ğŸ›¤', 'ğŸ›¥', 'ğŸ›§', 'ğŸ›¨', 'ğŸ›©', 'ğŸ›«', 'ğŸ›¬', 'ğŸ›°',
             'ğŸ›²', 'ğŸ›³', 'ğŸ›´', 'ğŸ›µ', 'ğŸ›¶', 'ğŸ›·', 'ğŸ›¸', 'ğŸ›¹', 'ğŸ›º', 'ğŸŸ ', 'ğŸŸ¡', 'ğŸŸ¢', 'ğŸŸ£', 'ğŸŸ¤', 'ğŸŸ¥', 'ğŸŸ¦', 'ğŸŸ§', 'ğŸŸ¨', 'ğŸŸ©', 'ğŸŸª', 'ğŸŸ«',
             'ğŸ¤', 'ğŸ¤', 'ğŸ¤', 'ğŸ¤', 'ğŸ¤’', 'ğŸ¤“', 'ğŸ¤”', 'ğŸ¤•', 'ğŸ¤–', 'ğŸ¤—', 'ğŸ¤˜', 'ğŸ¤™', 'ğŸ¤š', 'ğŸ¤›', 'ğŸ¤œ', 'ğŸ¤', 'ğŸ¤', 'ğŸ¤Ÿ', 'ğŸ¤ ', 'ğŸ¤¡', 'ğŸ¤¢',
             'ğŸ¤£', 'ğŸ¤¤', 'ğŸ¤¥', 'ğŸ¤¦', 'ğŸ¤§', 'ğŸ¤¨', 'ğŸ¤©', 'ğŸ¤ª', 'ğŸ¤«', 'ğŸ¤­', 'ğŸ¤®', 'ğŸ¤¯', 'ğŸ¤°', 'ğŸ¤±', 'ğŸ¤²', 'ğŸ¤³', 'ğŸ¤´', 'ğŸ¤¶', 'ğŸ¤·', 'ğŸ¤¸', 'ğŸ¤¹',
             'ğŸ¤º', 'ğŸ¤¼', 'ğŸ¤½', 'ğŸ¤¾', 'ğŸ¤¿', 'ğŸ¥€', 'ğŸ¥', 'ğŸ¥‚', 'ğŸ¥ƒ', 'ğŸ¥„', 'ğŸ¥…', 'ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', 'ğŸ¥Š', 'ğŸ¥‹', 'ğŸ¥Œ', 'ğŸ¥', 'ğŸ¥', 'ğŸ¥', 'ğŸ¥',
             'ğŸ¥‘', 'ğŸ¥’', 'ğŸ¥“', 'ğŸ¥”', 'ğŸ¥•', 'ğŸ¥–', 'ğŸ¥—', 'ğŸ¥˜', 'ğŸ¥™', 'ğŸ¥š', 'ğŸ¥›', 'ğŸ¥œ', 'ğŸ¥', 'ğŸ¥', 'ğŸ¥Ÿ', 'ğŸ¥ ', 'ğŸ¥¡', 'ğŸ¥¢', 'ğŸ¥£', 'ğŸ¥¤', 'ğŸ¥¥',
             'ğŸ¥¦', 'ğŸ¥§', 'ğŸ¥¨', 'ğŸ¥©', 'ğŸ¥ª', 'ğŸ¥«', 'ğŸ¥¬', 'ğŸ¥­', 'ğŸ¥®', 'ğŸ¥¯', 'ğŸ¥°', 'ğŸ¥±', 'ğŸ¥³', 'ğŸ¥´', 'ğŸ¥µ', 'ğŸ¥¶', 'ğŸ¥º', 'ğŸ¥»', 'ğŸ¥¼', 'ğŸ¥½', 'ğŸ¥¾',
             'ğŸ¥¿', 'ğŸ¦€', 'ğŸ¦', 'ğŸ¦‚', 'ğŸ¦ƒ', 'ğŸ¦„', 'ğŸ¦…', 'ğŸ¦†', 'ğŸ¦‡', 'ğŸ¦ˆ', 'ğŸ¦‰', 'ğŸ¦Š', 'ğŸ¦‹', 'ğŸ¦Œ', 'ğŸ¦', 'ğŸ¦', 'ğŸ¦', 'ğŸ¦', 'ğŸ¦‘', 'ğŸ¦’', 'ğŸ¦“',
             'ğŸ¦”', 'ğŸ¦•', 'ğŸ¦–', 'ğŸ¦—', 'ğŸ¦˜', 'ğŸ¦™', 'ğŸ¦š', 'ğŸ¦›', 'ğŸ¦œ', 'ğŸ¦', 'ğŸ¦', 'ğŸ¦Ÿ', 'ğŸ¦¡', 'ğŸ¦¢', 'ğŸ¦¥', 'ğŸ¦¦', 'ğŸ¦§', 'ğŸ¦¨', 'ğŸ¦©', 'ğŸ¦ª', 'ğŸ¦®',
             'ğŸ¦¯', 'ğŸ¦°', 'ğŸ¦±', 'ğŸ¦²', 'ğŸ¦³', 'ğŸ¦´', 'ğŸ¦µ', 'ğŸ¦¶', 'ğŸ¦·', 'ğŸ¦¸', 'ğŸ¦º', 'ğŸ¦»', 'ğŸ¦¼', 'ğŸ¦½', 'ğŸ¦¾', 'ğŸ¦¿', 'ğŸ§€', 'ğŸ§', 'ğŸ§‚', 'ğŸ§ƒ', 'ğŸ§„',
             'ğŸ§…', 'ğŸ§†', 'ğŸ§‡', 'ğŸ§ˆ', 'ğŸ§‰', 'ğŸ§Š', 'ğŸ§', 'ğŸ§’', 'ğŸ§“', 'ğŸ§–', 'ğŸ§', 'ğŸ§Ÿ', 'ğŸ§ ', 'ğŸ§¡', 'ğŸ§¢', 'ğŸ§£', 'ğŸ§¤', 'ğŸ§¥', 'ğŸ§¦', 'ğŸ§§', 'ğŸ§¨',
             'ğŸ§©', 'ğŸ§ª', 'ğŸ§«', 'ğŸ§¬', 'ğŸ§­', 'ğŸ§®', 'ğŸ§¯', 'ğŸ§°', 'ğŸ§±', 'ğŸ§²', 'ğŸ§³', 'ğŸ§´', 'ğŸ§µ', 'ğŸ§¶', 'ğŸ§·', 'ğŸ§¸', 'ğŸ§¹', 'ğŸ§º', 'ğŸ§»', 'ğŸ§¼', 'ğŸ§½',
             'ğŸ§¾', 'ğŸ§¿', 'ğŸ©°', 'ğŸ©±', 'ğŸ©²', 'ğŸ©³', 'ğŸ©¸', 'ğŸ©¹', 'ğŸ©º', 'ğŸª€', 'ğŸª', 'ğŸª‚', 'ğŸª', 'ğŸª‘', 'ğŸª’', 'ğŸª“', 'ğŸª”', 'ğŸª•', 'ğŸª¡']
trainer = BpeTrainer(special_tokens=['<unk>', 'Â§', '<eos>'],
                     vocab_size=32765 - 256,
                     min_frequency=3,
                     initial_alphabet=com_emoji,
                     max_token_length=5,
                     show_progress=True
                     )

if False:
    import os

    filePath = r'D:\datasets\h-corpus'
    filePath = [os.path.join(filePath, f) for f in os.listdir(filePath) if f.endswith('txt')][:1000]
else:
    filePath = [r'tmp_jieba.final.txt']

tokenizer.train(filePath, trainer=trainer)

tokenizer.save("HelloBPE.tokenizer.json", pretty=True)

import json

with open('HelloBPE.tokenizer.json', 'r', encoding='utf-8') as f:
    x = json.load(f)
y = {'<unk>': 0, 'Â§': 1, '<eos>': 2}
for i, v in enumerate(alphabet):
    y[v] = i + 3
for k, v in x['model']['vocab'].items():
    if k not in ['<unk>', 'Â§', '<eos>']:
        y[k] = v + 256
x['model']['vocab'] = y
with open('HelloBPE.tokenizer.json', 'w', encoding='utf-8') as f:
    json.dump(x, f, indent=2, ensure_ascii=False)

tokenizer = Tokenizer.from_file("HelloBPE.tokenizer.json")
tmp = tokenizer.encode('ä¸äº†ï¼Œæˆ‘æ›´å–œæ¬¢é‚£ç§é¢å¯¹ç¥ç§˜çš„æœŸå¾…æ„Ÿï¼Œè¿åŒä½ å¯¹äºæˆ‘ä»¬æ—…é€”çš„å®‰æ’ã€‚')
print(tmp.tokens, '\n', tokenizer.decode(tmp.ids))
print(tokenizer.normalizer.normalize_str('hello   world'))
print(tokenizer.pre_tokenizer.pre_tokenize_str('GaaaÄ aaaä½ å¥½'))
print(tokenizer.encode(
    'ä½ æ˜¯ä¸€ä¸ªè½»å°è¯´ç¿»è¯‘æ¨¡å‹ï¼Œå¯ä»¥æµç•…é€šé¡ºåœ°ä»¥æ—¥æœ¬è½»å°è¯´çš„é£æ ¼å°†æ—¥æ–‡ç¿»è¯‘æˆç®€ä½“ä¸­æ–‡ ï¼Œå¹¶è”ç³»ä¸Šä¸‹æ–‡æ­£ç¡®ä½¿ç”¨äººç§°ä»£è¯ï¼Œä¸æ“…è‡ªæ·»åŠ åŸæ–‡ä¸­æ²¡æœ‰çš„ä»£è¯').tokens)
print(tokenizer.encode(
    'åœ¨è¢«é—®åˆ°é”¡å…°è¿˜æœ‰åšå£«æ›´å–œæ¬¢è°çš„æ—¶å€™ï¼Œé»‘æ”¯æ”¯å¾å¾åœ°ä¸æ„¿æ„è¯´è¯ã€‚åŸå› ä¹Ÿå¾ˆç®€å•ï¼Œæ­¤æ—¶çš„å¥¹åˆšåˆšç»“æŸä¸è‡ªå·±ä¾å¥‰çš„å¤§å°å§å’Œåšå£«åŒé£ä¹‹åçš„è¿·æƒ…ï¼Œè¢«ä¸€èµ·åŒç™»æä¹çš„ä¸¤ä¸ªäººä¸€èµ·è¿™ä¹ˆé—®ï¼Œè‡ªç„¶ä¸çŸ¥é“åº”è¯¥æ€ä¹ˆå›ç­”ã€‚ç»“æœä½œä¸ºæƒ©ç½šï¼Œå¥¹è¢«è¿˜æ²¡æœ‰ç©å¤Ÿçš„åšå£«æŒ‰ç€çŒ›çƒˆè¿›å…¥ï¼Œè¢«é”¡å…°äº²å»ç€ç£¨è¹­ç€ä¸‹ä½“ï¼Œç„¶åè¢«ä¸¤äººä¸€èµ·ç‹ ç‹ åœ°åšåˆ°ä¸çŸ¥é«˜æ½®äº†å‡ æ¬¡ï¼Œç›´åˆ°æ„è¯†æ¨¡ç³Šæ˜ç¡åˆ°äº†æ¬¡æ—¥ã€‚').tokens)
# with open(r'tmp_jieba.final.txt', 'r', encoding='utf-8') as f:
#     tmp2 = tokenizer.pre_tokenizer.pre_tokenize_str(f.read()[-10000:])
